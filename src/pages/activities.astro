---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { useTranslations } from "../libs/i18n";
import { Icon } from "astro-icon/components";

const { t, l, getCollection } = useTranslations(Astro.url);

const activities = await getCollection("activities");

const categories = [
    { id: "all", name: { ja: "すべて", en: "All", zh: "全部", ko: "전체" } },
    { id: "event", name: { ja: "イベント", en: "Events", zh: "活动", ko: "이벤트" } },
    { id: "workshop", name: { ja: "ワークショップ", en: "Workshops", zh: "工作坊", ko: "워크숍" } },
    { id: "creation", name: { ja: "創作", en: "Creations", zh: "创作", ko: "창작" } },
    { id: "contest", name: { ja: "コンテスト", en: "Contests", zh: "比赛", ko: "콘테스트" } },
    { id: "academic", name: { ja: "学術", en: "Academic", zh: "学术", ko: "학술" } },
    { id: "other", name: { ja: "その他", en: "Others", zh: "其他", ko: "기타" } },
];
---

<Layout
    title={t({
        ja: "活動紹介",
        en: "Activities",
        zh: "活动介绍",
        ko: "활동 소개",
    })}
    description={t({
        ja: "OUS Metaverseの活動内容をご紹介します。メタバース空間を活用したイベントやワークショップなど、さまざまな活動を行っています。",
        en: "Introduction to OUS Metaverse activities. We conduct various activities such as events and workshops utilizing metaverse spaces.",
        zh: "介绍OUS Metaverse的活动内容。我们开展各种活动，如利用元宇宙空间的活动和工作坊。",
        ko: "OUS Metaverse의 활동 내용을 소개합니다. 메타버스 공간을 활용한 이벤트와 워크숍 등 다양한 활동을 진행하고 있습니다.",
    })}
>
    <main>
        {/* Hero Section */}
        <div class="hero from-base-200 to-base-100 bg-gradient-to-b py-20">
            <div class="hero-content text-center">
                <div>
                    <h1 class="text-4xl font-bold md:text-5xl">
                        {
                            t({
                                ja: "活動紹介",
                                en: "Our Activities",
                                zh: "活动介绍",
                                ko: "활동 소개",
                            })
                        }
                    </h1>
                    <p class="max-w-3xl py-6 text-lg">
                        {
                            t({
                                ja: "OUS Metaverseでは、メタバース空間を活用したさまざまな活動を行っています。イベントやワークショップ、創作活動など、メンバーそれぞれが興味のある分野で活躍しています。",
                                en: "At OUS Metaverse, we conduct various activities utilizing metaverse spaces. Each member is active in their areas of interest, such as events, workshops, and creative activities.",
                                zh: "在OUS Metaverse，我们开展各种利用元宇宙空间的活动。每个成员都在自己感兴趣的领域活跃，如活动、工作坊和创作活动等。",
                                ko: "OUS Metaverse에서는 메타버스 공간을 활용한 다양한 활동을 진행하고 있습니다. 각 멤버는 이벤트, 워크숍, 창작 활동 등 관심 있는 분야에서 활발히 활동하고 있습니다.",
                            })
                        }
                    </p>
                </div>
            </div>
        </div>

        {/* Activities Section */}
        <div class="container mx-auto px-4" id="article-list" data-category="all">
            {/* Category Filter */}
            <form id="category-filter">
                {/* Category Filter - Mobile */}
                <div class="mb-12 flex justify-center md:hidden">
                    <select class="select select-bordered w-full max-w-xs" name="category">
                        {
                            categories.map((category) => (
                                <option value={category.id}>{t(category.name)}</option>
                            ))
                        }
                    </select>
                </div>

                {/* Category Filter - Desktop */}
                <div class="join mb-12 hidden justify-center md:flex">
                    {
                        categories.map((category) => (
                            <input
                                class="join-item btn category-filter"
                                type="radio"
                                name="category"
                                checked={category.id === "all"}
                                aria-label={t(category.name)}
                                value={category.id}
                            />
                        ))
                    }
                </div>
            </form>

            {/* Featured Activities */}
            <div class="mb-16">
                <h2 class="mb-8 text-2xl font-bold">
                    {
                        t({
                            ja: "注目の活動",
                            en: "Featured Activities",
                            zh: "精选活动",
                            ko: "주목할 만한 활동",
                        })
                    }
                </h2>

                <div class="grid gap-8 lg:grid-cols-2">
                    {
                        activities
                            .filter((activity) => activity.data.featured)
                            .slice(0, 2)
                            .map((activity) => (
                                <a
                                    href={l(`/activities/${activity.slug}`)}
                                    class="card bg-base-100 article-card hidden shadow-xl"
                                    data-category={activity.data.category}
                                >
                                    <figure>
                                        <Image
                                            src={activity.data.image}
                                            alt={activity.data.title}
                                            class="h-full w-full object-cover"
                                        />
                                    </figure>
                                    <div class="card-body">
                                        <div class="mb-3 flex items-center justify-between">
                                            <span class="badge badge-primary">
                                                {t(
                                                    categories.find(
                                                        (cat) => cat.id === activity.data.category,
                                                    )?.name || {
                                                        ja: "その他",
                                                        en: "Others",
                                                        zh: "其他",
                                                        ko: "기타",
                                                    },
                                                )}
                                            </span>
                                            <span class="text-sm opacity-70">
                                                {activity.data.date.toLocaleDateString(
                                                    Astro.currentLocale || "ja-JP",
                                                    {
                                                        year: "numeric",
                                                        month: "long",
                                                        day: "numeric",
                                                    },
                                                )}
                                            </span>
                                        </div>
                                        <h3 class="card-title">{activity.data.title}</h3>
                                        <p>{activity.data.summary}</p>
                                        <div class="card-actions mt-4 justify-end">
                                            <button class="btn btn-primary btn-sm">
                                                {t({
                                                    ja: "詳細を見る",
                                                    en: "Read More",
                                                    zh: "阅读更多",
                                                    ko: "자세히 보기",
                                                })}
                                                <Icon name="mdi:arrow-right" class="ml-1 h-4 w-4" />
                                            </button>
                                        </div>
                                    </div>
                                </a>
                            ))
                    }
                </div>
            </div>

            {/* All Activities */}
            <h2 class="mb-8 text-2xl font-bold">
                {
                    t({
                        ja: "すべての活動",
                        en: "All Activities",
                        zh: "所有活动",
                        ko: "모든 활동",
                    })
                }
            </h2>

            <div class="mb-16 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
                {
                    activities.map((activity) => (
                        <div
                            class="card bg-base-100 article-card hidden shadow-md hover:shadow-lg"
                            data-category={activity.data.category}
                        >
                            <figure>
                                <Image
                                    src={activity.data.image}
                                    alt={activity.data.title}
                                    class="h-full w-full object-cover"
                                />
                            </figure>
                            <div class="card-body p-4">
                                <div class="mb-2 flex items-center justify-between">
                                    <span class="badge badge-sm badge-primary">
                                        {t(
                                            categories.find(
                                                (cat) => cat.id === activity.data.category,
                                            )?.name || {
                                                ja: "その他",
                                                en: "Others",
                                                zh: "其他",
                                                ko: "기타",
                                            },
                                        )}
                                    </span>
                                    <span class="text-xs opacity-70">
                                        {activity.data.date.toLocaleDateString(
                                            Astro.currentLocale || "ja-JP",
                                            {
                                                year: "numeric",
                                                month: "long",
                                                day: "numeric",
                                            },
                                        )}
                                    </span>
                                </div>
                                <h3 class="card-title text-base">{activity.data.title}</h3>
                                <p class="line-clamp-2 text-sm opacity-80">
                                    {activity.data.summary}
                                </p>
                                <div class="card-actions mt-2 justify-end">
                                    <a
                                        href={l(`/activities/${activity.slug}`)}
                                        class="btn btn-sm btn-link"
                                    >
                                        {t({
                                            ja: "詳細",
                                            en: "Details",
                                            zh: "详情",
                                            ko: "세부사항",
                                        })}
                                    </a>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
        <script>
            const categoryFilter = document.getElementById("category-filter") as HTMLFormElement;
            const articleList = document.getElementById("article-list")!;

            categoryFilter.addEventListener("change", (event) => {
                const selectedCategory = (event.target as HTMLInputElement).value;
                articleList.dataset.category = selectedCategory;
            });
        </script>
    </main>
</Layout>

<style>
    [data-category="all"] .article-card {
        display: block;
    }
    [data-category="event"] .article-card[data-category="event"] {
        display: block;
    }
    [data-category="workshop"] .article-card[data-category="workshop"] {
        display: block;
    }
    [data-category="creation"] .article-card[data-category="creation"] {
        display: block;
    }
    [data-category="contest"] .article-card[data-category="contest"] {
        display: block;
    }
    [data-category="academic"] .article-card[data-category="academic"] {
        display: block;
    }
    [data-category="other"] .article-card[data-category="other"] {
        display: block;
    }
</style>
